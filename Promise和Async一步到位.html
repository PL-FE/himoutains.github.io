<!DOCTYPE html><html lang="zh-CN"><!--
             -. .                                        
       _____   ',' ,                                    
     ,'     ,'   ', ',                                  
   ,'     ,'      |  |                                  
   \       \       |  |                                  
     \ /^\   \    ,' ,'                                  
           \   \ ,' ,'      L'Internationale,            
     / ~-.___\.-'  ,'            Sera le genre humain.   
   /   .______.- ~ \                                     
 /   /'          \   \                                   
 \./               \/'                                   
                                                         
--><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="pengliang"><title>ç¬”è®°-Promiseå’ŒAsyncä¸€æ­¥åˆ°ä½ Â· é“¶ä¹‹åŒ™</title><meta name="description" content="å‰è¨€
åœ¨é¡¹ç›®ä¸­ç»å¸¸æ¥è§¦å¼‚æ­¥ä»»åŠ¡, è¦æ˜¯ç›¸äº’ç‹¬ç«‹è¿˜å¥½ï¼Œè¦æ˜¯å®ƒä»¬ç›¸äº’ä¾èµ–ï¼Œé‚£å°±éº»çƒ¦å’¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŒæ¡ä¸€äº›æ§åˆ¶å®ƒä»¬çš„æ–¹æ³•ï¼ˆæ¯•ç«Ÿè‡ªå·±çš„ä»£ç è¿˜æ˜¯åº”è¯¥åœ¨è‡ªå·±æŒæ§ä¹‹ä¸‹ï¼Œä»£ç å¯ä¿¡ï¼‰ï¼Œæ§åˆ¶å®ƒä»¬åŠ è½½çš„æ—¶æœº


å‡†å¤‡æˆ‘ä»¬éƒ½çŸ¥é“ JavaScript æ˜¯å•çº¿ç¨‹ï¼Œå•çº¿ç¨‹å°±æ„å‘³ç€ï¼Œä»»åŠ¡è¦ä¸€ä»¶ä»¶æ¥åŠï¼ŒJavaScript å¼•æ“"><meta name="keywords" content="vue"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/valine.min.js"></script><meta name="generator" content="Hexo 4.2.1"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><script src="/js/prism.js"></script>
<script src="/js/prism-line-numbers.min.js"></script></head><body><span class="donate-address">å”¯ä¸€æŒ‡å®šé‚®ç®±ï¼špenglianger@qq.com</span><div id="stage" class="container"><div class="row"><div id="side-bar" class="col-sm-3 col-xs-12 side-container invisible"><div class="vertical-text site-title"><h3 tabindex="-1" class="site-title-small"><a href="/" class="a-title">ä¸è¦å˜æˆè®°å½•åœ¨æœ¬å­ä¸Šçš„äººç”Ÿ</a></h3><h1 tabindex="-1" class="site-title-large"><a href="/" class="a-title">é“¶ä¹‹åŒ™</a></h1><!--h6(onclick="triggerSiteNav()") Trigger--></div><br class="visible-lg visible-md visible-sm"><div id="site-nav" class="site-title-links"><ul><li><a href="/">é¦–é¡µ</a></li><li><a href="/archives">å½’æ¡£</a></li><li><a href="/categories">åˆ†ç±»</a></li><li><a href="/tags">æ ‡ç­¾</a></li><li class="soc"><a href="https://github.com/Samlldevel" target="_blank" rel="noopener noreferrer"><i class="fa fa-github">&nbsp;</i></a><a href="https://twitter.com/Samlldevel" target="_blank" rel="noopener noreferrer"><i class="fa fa-twitter">&nbsp;</i></a><a href="https://github.com/PL-FE/atom.xml" target="_blank" rel="noopener noreferrer"><i class="fa fa-rss">&nbsp;</i></a></li></ul><div class="visible-lg visible-md visible-sm site-nav-footer"><br class="site-nav-footer-br"><footer><p>&copy;&nbsp;2020&nbsp;<a target="_blank" href="https://github.com/PL-FE" rel="noopener noreferrer">pengliang</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div><div id="main-container" class="col-sm-9 col-xs-12 main-container invisible"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post-container"><h1 class="post-title">ç¬”è®°-Promiseå’ŒAsyncä¸€æ­¥åˆ°ä½</h1><p class="post-meta"><span class="date meta-item">å‘å¸ƒäº&nbsp;2020-06-07</span><span class="meta-item"><i class="fa fa-folder"></i><span>&nbsp;</span><a href="/categories/JavaScript/" title="JavaScript" class="a-tag">JavaScript</a><span>&nbsp;</span></span><span class="meta-item"><i class="fa fa-tag"></i><span>&nbsp;</span><a href="/tags/çŸ¥è¯†ç‚¹/" title="çŸ¥è¯†ç‚¹" class="a-tag">çŸ¥è¯†ç‚¹</a><span>&nbsp;</span><a href="/tags/å¼‚æ­¥/" title="å¼‚æ­¥" class="a-tag">å¼‚æ­¥</a><span>&nbsp;</span></span></p><p class="post-abstract"><p><img src="./Promise%E5%92%8CAsync%E4%B8%80%E6%AD%A5%E5%88%B0%E4%BD%8D/Asynchronous.png" alt="Asynchronous"></p>
<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><blockquote>
<p>åœ¨é¡¹ç›®ä¸­ç»å¸¸æ¥è§¦<code>å¼‚æ­¥ä»»åŠ¡</code>, è¦æ˜¯ç›¸äº’ç‹¬ç«‹è¿˜å¥½ï¼Œè¦æ˜¯å®ƒä»¬ç›¸äº’ä¾èµ–ï¼Œé‚£å°±éº»çƒ¦å’¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŒæ¡ä¸€äº›æ§åˆ¶å®ƒä»¬çš„æ–¹æ³•ï¼ˆæ¯•ç«Ÿè‡ªå·±çš„ä»£ç è¿˜æ˜¯åº”è¯¥åœ¨è‡ªå·±æŒæ§ä¹‹ä¸‹ï¼Œä»£ç å¯ä¿¡ï¼‰ï¼Œæ§åˆ¶å®ƒä»¬åŠ è½½çš„æ—¶æœº</p>
</blockquote>
<hr>
<h3 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“ JavaScript æ˜¯å•çº¿ç¨‹ï¼Œå•çº¿ç¨‹å°±æ„å‘³ç€ï¼Œä»»åŠ¡è¦ä¸€ä»¶ä»¶æ¥åŠï¼ŒJavaScript å¼•æ“æ‰§è¡Œå¼‚æ­¥ä»£ç è€Œä¸ç”¨ç­‰å¾…ï¼Œæ˜¯å› ä¸ºæœ‰<code>æ¶ˆæ¯é˜Ÿåˆ—</code>å’Œ<code>äº‹ä»¶å¾ªç¯ (Event Loop)</code></p>
<p><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong><br>æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—ï¼Œå®ƒé‡Œé¢å­˜æ”¾ç€ä»»åŠ¡ã€‚<br>è€Œæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¯ä¸ªä»»åŠ¡éƒ½ç§°ä¹‹ä¸ºå®ä»»åŠ¡ï¼Œæ¯ä¸ªå®ä»»åŠ¡ä¸­éƒ½å­˜æ”¾ç€ä¸€ä¸ªå¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚<br>å½“å®ä»»åŠ¡ç»“æŸå‰ï¼Œä¼šæ‰§è¡Œå¾®ä»»åŠ¡åˆ—è¡¨ä¸­çš„ä»»åŠ¡ï¼Œå®Œæˆä¹‹åæ‰ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ã€‚<br>å¾®ä»»åŠ¡ä¸»è¦ç”¨æ¥è§£å†³ä»»åŠ¡ä¼˜å…ˆçº§çš„é—®é¢˜å’Œå•ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´è¿‡é•¿çš„é—®é¢˜ã€‚</p>
<p><strong>å¾®ä»»åŠ¡åŒ…æ‹¬</strong>ï¼š<code>MutationObserver</code>ã€<code>Promise.then()</code>æˆ– <code>catch()</code>ã€<code>Promise ä¸ºåŸºç¡€å¼€å‘çš„å…¶å®ƒæŠ€æœ¯</code>ï¼Œæ¯”å¦‚ <code>fetch APIã€V8</code> çš„åƒåœ¾å›æ”¶è¿‡ç¨‹ã€Node ç‹¬æœ‰çš„ <code>process.nextTick</code></p>
<p><strong>å®ä»»åŠ¡åŒ…æ‹¬</strong>ï¼š<code>script</code> ã€<code>setTimeout</code>ã€<code>setInterval</code> ã€<code>setImmediate</code> ã€<code>I/O</code> ã€<code>UI rendering</code></p>
<p><strong>Event Loop</strong><br>ä¸»çº¿ç¨‹çš„è¯»å–è¿‡ç¨‹åŸºæœ¬ä¸Šæ˜¯è‡ªåŠ¨çš„ï¼Œåªè¦æ‰§è¡Œæ ˆä¸€æ¸…ç©ºï¼Œâ€æ¶ˆæ¯é˜Ÿåˆ—â€ä¸Šç¬¬ä¸€ä½çš„äº‹ä»¶å°±è‡ªåŠ¨è¿›å…¥ä¸»çº¿ç¨‹ã€‚<br>è¿™ä¸ªè¿‡ç¨‹æ˜¯å¾ªç¯ä¸æ–­çš„ï¼Œæ‰€ä»¥æ•´ä¸ªçš„è¿™ç§è¿è¡Œæœºåˆ¶åˆç§°ä¸º <code>Event Loopï¼ˆäº‹ä»¶å¾ªç¯ï¼‰</code>ã€‚</p>
<p>event loop çš„æ‰§è¡Œé¡ºåºï¼š</p>
<ul>
<li>ä¸€å¼€å§‹æ•´ä¸ªè„šæœ¬ä½œä¸ºä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œ</li>
<li>æ‰§è¡Œè¿‡ç¨‹ä¸­åŒæ­¥ä»£ç ç›´æ¥æ‰§è¡Œï¼Œå®ä»»åŠ¡è¿›å…¥å®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¾®ä»»åŠ¡è¿›å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>å½“å‰å®ä»»åŠ¡æ‰§è¡Œå®Œå‡ºé˜Ÿï¼Œæ£€æŸ¥å¾®ä»»åŠ¡åˆ—è¡¨ï¼Œæœ‰åˆ™ä¾æ¬¡æ‰§è¡Œï¼Œç›´åˆ°å…¨éƒ¨æ‰§è¡Œå®Œ</li>
<li>æ‰§è¡Œæµè§ˆå™¨ UI çº¿ç¨‹çš„æ¸²æŸ“å·¥ä½œ</li>
<li>æ£€æŸ¥æ˜¯å¦æœ‰ Web Worker ä»»åŠ¡ï¼Œæœ‰åˆ™æ‰§è¡Œ</li>
<li>æ‰§è¡Œå®Œæœ¬è½®çš„å®ä»»åŠ¡ï¼Œå›åˆ° 2ï¼Œä¾æ­¤å¾ªç¯ï¼Œç›´åˆ°å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡é˜Ÿåˆ—éƒ½ä¸ºç©º</li>
</ul>
<hr>
<h3 id="Promise-é¢˜ç›®"><a href="#Promise-é¢˜ç›®" class="headerlink" title="Promise é¢˜ç›®"></a>Promise é¢˜ç›®</h3><ul>
<li>é‡åˆ°å£°æ˜å˜é‡å³è¾¹æ˜¯æ™®é€šåŒæ­¥ä»£ç ä¹Ÿä¼šæ‰§è¡Œ(ä»£ç åŒ…è£¹åœ¨å‡½æ•°ä½“å†… åˆ™åœ¨è°ƒç”¨å¤„æ‰§è¡Œ)</li>
<li><code>new Promise()</code> ä¸­æ²¡æœ‰ <code>resolve()</code> æˆ–è€… <code>reject()</code> ä¸ä¼šæ‰§è¡Œå®ƒçš„ <code>then()</code></li>
<li><code>promise.then()</code> æ”¯æŒé“¾å¼å†™æ³•ï¼Œå¯å¾—çŸ¥å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„ <code>promise</code></li>
<li><code>å®šæ—¶å™¨</code> åŠŸèƒ½ï¼Œä¸»çº¿ç¨‹é¦–å…ˆè¦æ£€æŸ¥ä¸€ä¸‹æ‰§è¡Œæ—¶é—´ï¼ŒæŸäº›äº‹ä»¶åªæœ‰åˆ°äº†è§„å®šçš„æ—¶é—´ï¼Œæ‰èƒ½è¿”å›ä¸»çº¿ç¨‹</li>
<li>å¦‚æœåœ¨æ‰§è¡Œ <code>å¾®ä»»åŠ¡</code> çš„è¿‡ç¨‹ä¸­ï¼Œåˆäº§ç”Ÿäº† <code>å¾®ä»»åŠ¡</code>ï¼Œé‚£ä¹ˆä¼šåŠ å…¥åˆ°é˜Ÿåˆ—çš„æœ«å°¾ï¼Œä¹Ÿä¼šåœ¨è¿™ä¸ªå‘¨æœŸè¢«è°ƒç”¨æ‰§è¡Œï¼›</li>
</ul>
<p><img src="./Promise%E5%92%8CAsync%E4%B8%80%E6%AD%A5%E5%88%B0%E4%BD%8D/%E7%BD%91%E4%B8%8A%E7%9B%97%E5%9B%BE%E4%B8%80%E5%BC%A0.png" alt="ç½‘ä¸Šç›—å›¾ä¸€å¼ "></p>
<h4 id="åŸºç¡€-Promise"><a href="#åŸºç¡€-Promise" class="headerlink" title="åŸºç¡€ Promise"></a>åŸºç¡€ Promise</h4><h4 id="1-1"><a href="#1-1" class="headerlink" title="1.1"></a>1.1</h4><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">const</span> promise1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> promise1<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿‡ç¨‹åˆ†æï¼š</p>
<ul>
<li>ä»ä¸Šè‡³ä¸‹ï¼Œå…ˆé‡åˆ° <code>new Promise</code>ï¼Œæ‰§è¡Œè¯¥æ„é€ å‡½æ•°ä¸­çš„ä»£ç  <code>promise1</code></li>
<li>ç„¶åæ‰§è¡ŒåŒæ­¥ä»£ç  <code>1</code>ï¼Œæ­¤æ—¶ <code>promise1</code> æ²¡æœ‰è¢« <code>resolve</code> æˆ–è€… <code>reject</code>ï¼Œå› æ­¤çŠ¶æ€è¿˜æ˜¯ <code>pending</code></li>
</ul>
<p>æ€»ç»“ï¼š</p>
<ol>
<li>é‡åˆ°å£°æ˜å˜é‡å³è¾¹æ˜¯æ™®é€šåŒæ­¥ä»£ç ä¹Ÿä¼šæ‰§è¡Œ(ä»£ç åŒ…è£¹åœ¨å‡½æ•°ä½“å†… åˆ™åœ¨è°ƒç”¨å¤„æ‰§è¡Œ)</li>
</ol>
<p>è¾“å‡º:</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token string">'promise1'</span>
<span class="token string">'1'</span> Promise<span class="token punctuation">{</span><span class="token operator">&lt;</span>pending<span class="token operator">></span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="1-2"><a href="#1-2" class="headerlink" title="1.2"></a>1.2</h4><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿‡ç¨‹åˆ†æï¼š</p>
<ul>
<li>ä»ä¸Šè‡³ä¸‹ï¼Œå…ˆé‡åˆ° <code>new Promise</code>ï¼Œæ‰§è¡Œè¯¥æ„é€ å‡½æ•°ä¸­çš„ä»£ç </li>
<li>é‡åˆ° <code>console.log(1)</code>ï¼Œè¾“å‡º <code>1</code></li>
<li>é‡åˆ° <code>resolve(&quot;success&quot;);</code> å°† promise çŠ¶æ€æ”¹ä¸º resolve ï¼Œå¹¶å°†å€¼ä¿å­˜ä¸‹æ¥</li>
<li>é‡åˆ° <code>console.log(2)</code>ï¼Œè¾“å‡º <code>2</code></li>
<li><code>new Promise</code> å†…éƒ¨ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œè·³å‡ºæ¥é‡åˆ° <code>promise.then()</code>ï¼Œå°†å…¶åŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>é‡åˆ° <code>console.log(4)</code>ï¼Œè¾“å‡º <code>4</code></li>
<li>æœ¬è½®å®ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼Œæ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå‘ç° <code>promise.then()</code> è¿™ä¸ªå¾®ä»»åŠ¡ä¸”çŠ¶æ€ä¸º <code>resolved</code>ï¼Œæ‰§è¡Œå®ƒ,è¾“å‡º <code>3</code>ã€‚</li>
</ul>
<p>è¾“å‡º:</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token number">1</span> <span class="token number">2</span> <span class="token number">4</span> <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="1-3"><a href="#1-3" class="headerlink" title="1.3"></a>1.3</h4><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿‡ç¨‹åˆ†æï¼š</p>
<p>å› ä¸º<code>new Promise()</code> ä¸­æ²¡æœ‰ <code>resolve()</code> æˆ–è€… <code>reject()</code> ä¸ä¼šæ‰§è¡Œå®ƒçš„ <code>then()</code></p>
<p>è¾“å‡º:</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token number">1</span> <span class="token number">2</span> <span class="token number">4</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="1-4"><a href="#1-4" class="headerlink" title="1.4"></a>1.4</h4><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">const</span> promise1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'resolve1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> promise2 <span class="token operator">=</span> promise1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> promise1<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span> promise2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿‡ç¨‹åˆ†æï¼š</p>
<ul>
<li>ä»ä¸Šè‡³ä¸‹ï¼Œå…ˆé‡åˆ° <code>new Promise</code>ï¼Œæ‰§è¡Œè¯¥æ„é€ å‡½æ•°ä¸­çš„ä»£ç </li>
<li>ä»ä¸Šè‡³ä¸‹ï¼Œå…ˆé‡åˆ° <code>new Promise</code>ï¼Œæ‰§è¡Œè¯¥æ„é€ å‡½æ•°ä¸­çš„ä»£ç </li>
<li>é‡åˆ° <code>console.log(&quot;promise1&quot;);</code>ï¼Œè¾“å‡º <code>promise1</code></li>
<li>é‡åˆ° <code>resolve(&quot;resolve1&quot;);</code> å°† promise çŠ¶æ€æ”¹ä¸º <code>resolve</code> ï¼Œå¹¶å°†å€¼ä¿å­˜ä¸‹æ¥</li>
<li><code>new Promise</code> å†…éƒ¨ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œè·³å‡ºæ¥é‡åˆ° <code>promise.then()</code>ï¼Œå°†å…¶åŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>é‡åˆ° <code>console.log(&quot;1&quot;, promise1);</code>ï¼Œä¸” <code>promise1</code> çš„çŠ¶æ€å·²ç»è¢«æ”¹å˜ä¸º <code>resolve</code>ï¼Œ è¾“å‡º <code>1 Promise{&lt;resolved&gt;: &#39;resolve1&#39;}</code>,</li>
<li>é‡åˆ° <code>console.log(&quot;2&quot;, promise2);</code>ï¼Œä¸” <code>promise2</code> æ˜¯æ–°çš„ çŠ¶æ€ä¸º pendding çš„ promiseï¼Œ è¾“å‡º <code>2 Promise{&lt;pendding&gt;}</code>,</li>
<li>å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼ŒæŸ¥æ‰¾å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå‘ç° <code>promise1.then()</code> è¿™ä¸ªå¾®ä»»åŠ¡ä¸”çŠ¶æ€ä¸º <code>resolved</code>ï¼Œæ‰§è¡Œå®ƒï¼Œè¾“å‡º <code>resolve1</code></li>
</ul>
<p>æ€»ç»“ï¼š</p>
<ol>
<li><code>promise.then()</code> æ”¯æŒé“¾å¼å†™æ³•ï¼Œå¯å¾—çŸ¥å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„ <code>promise</code></li>
</ol>
<p>è¾“å‡º:</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token string">'promise1'</span>
<span class="token string">'1'</span> Promise<span class="token punctuation">{</span><span class="token operator">&lt;</span>resolved<span class="token operator">></span><span class="token punctuation">:</span> <span class="token string">'resolve1'</span><span class="token punctuation">}</span>
<span class="token string">'2'</span> Promise<span class="token punctuation">{</span><span class="token operator">&lt;</span>pendding<span class="token operator">></span><span class="token punctuation">}</span>
<span class="token string">'resolve1'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="1-5"><a href="#1-5" class="headerlink" title="1.5"></a>1.5</h4><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">const</span> fn <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¦ç‚¹ï¼š<code>å‡½æ•°è°ƒç”¨æ—¶æ‰æ‰§è¡Œå†…éƒ¨é€»è¾‘</code></p>
<p>è¿‡ç¨‹åˆ†æï¼š</p>
<ul>
<li>ä»ä¸Šè‡³ä¸‹ï¼Œå…ˆé‡åˆ°å£°æ˜ <code>fn ()</code>ï¼Œå‡½æ•°å†…éƒ¨ä»£ç åœ¨å‡½æ•°è°ƒç”¨å¤„æ‰§è¡Œ</li>
<li>é‡åˆ°è°ƒç”¨ <code>fn()</code>ï¼Œæ‰§è¡Œå†…éƒ¨ä»£ç ï¼Œè¾“å‡º <code>1</code></li>
<li>é‡åˆ° <code>resolve(&quot;success&quot;);</code> å°† promise çŠ¶æ€æ”¹ä¸º <code>resolve</code> ï¼Œå¹¶å°†å€¼ä¿å­˜ä¸‹æ¥</li>
<li>å®Œæˆå‡½æ•°å†…éƒ¨è°ƒç”¨ï¼Œè·³å‡ºå‡½æ•°å†…éƒ¨ï¼Œ é‡åˆ° <code>promise.then()</code>ï¼Œå°†å…¶åŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>é‡åˆ° <code>console.log(start);</code>ï¼Œè¾“å‡º <code>start</code></li>
<li>å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼ŒæŸ¥æ‰¾å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå‘ç° fn å‡½æ•°çš„ <code>then()</code> è¿™ä¸ªå¾®ä»»åŠ¡ä¸”çŠ¶æ€ä¸º <code>resolved</code>ï¼Œæ‰§è¡Œå®ƒï¼Œè¾“å‡º <code>success</code></li>
</ul>
<p>è¾“å‡º:</p>
<pre class="line-numbers language-cmd"><code class="language-cmd">1
'start'
'success'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="1-6"><a href="#1-6" class="headerlink" title="1.6"></a>1.6</h4><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">const</span> fn <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è‹¥æ˜¯ fn åœ¨æœ€åè°ƒç”¨ï¼Œç»“æœä¹Ÿå¾ˆæ˜æ˜¾äº†</p>
<p>è¾“å‡º:</p>
<pre class="line-numbers language-cmd"><code class="language-cmd">'start'
1
'success'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="Promise-ä¸-setTimeout"><a href="#Promise-ä¸-setTimeout" class="headerlink" title="Promise ä¸ setTimeout"></a>Promise ä¸ setTimeout</h4><h4 id="2-1"><a href="#2-1" class="headerlink" title="2.1"></a>2.1</h4><pre class="line-numbers language-js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'time'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resolve'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¦ç‚¹ï¼š<code>setTimeout</code>ä¸ºå»¶è¿Ÿä»»åŠ¡ï¼Œæ·»åŠ åˆ°ä¸‹ä¸€è½®å®ä»»åŠ¡ï¼Œå¹¶ä¸”åˆ°æ—¶é—´æ‰ä¼šè¢«å…¥æ ˆ</p>
<p>è¿‡ç¨‹åˆ†æï¼š</p>
<ul>
<li>ä»ä¸Šè‡³ä¸‹ï¼Œé‡åˆ° <code>console.log(start);</code>ï¼Œè¾“å‡º <code>start</code></li>
<li>é‡åˆ° <code>setTimeout()</code>æ˜¯ä¸ªå®ä»»åŠ¡ï¼Œè¿›å…¥ä¸‹ä¸€è½®çš„å®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆğŸš¦ æ³¨æ„ï¼šæ˜¯ä¸‹ä¸€è½®ï¼‰ï¼Œå³<code>å® 2</code>ï¼ˆç¬¬äºŒè½®å®ä»»åŠ¡ï¼‰</li>
<li>é‡åˆ° <code>Promise.resolve()</code> ç›´æ¥æ‰§è¡Œï¼Œå°† promise çŠ¶æ€æ”¹ä¸º <code>resolve</code>ï¼Œ å°† <code>then()</code> æ”¾å…¥æœ¬è½®å¾®ä»»åŠ¡</li>
<li>ä»ä¸Šè‡³ä¸‹ï¼Œé‡åˆ° <code>console.log(end);</code>ï¼Œè¾“å‡º <code>end</code></li>
<li>æœ¬è½®å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼ŒæŸ¥æ‰¾å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå‘ç° <code>then()</code> è¿™ä¸ªå¾®ä»»åŠ¡ä¸”çŠ¶æ€ä¸º <code>resolved</code>ï¼Œæ‰§è¡Œå®ƒï¼Œè¾“å‡º <code>resolve</code></li>
<li>ä¸‹ä¸€è½®å®ä»»åŠ¡ï¼ˆå® 2ï¼‰å¼€å§‹ï¼Œæ‰§è¡Œ <code>setTimeout</code>ï¼Œè¾“å‡º <code>time</code></li>
</ul>
<p>è¾“å‡º:</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token string">'start'</span>
<span class="token string">'end'</span>
<span class="token string">'reslove'</span>
<span class="token string">'time'</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="2-2"><a href="#2-2" class="headerlink" title="2.2"></a>2.2</h4><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timerStart'</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timerEnd'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¦ç‚¹ï¼š<code>setTimeout</code> ä¸ºå®ä»»åŠ¡, <code>promise.then()</code> çŠ¶æ€ä¸º <code>padding</code> ä¸æ‰§è¡Œ</p>
<p>è¿‡ç¨‹åˆ†æï¼š</p>
<ul>
<li><p>ä»ä¸Šè‡³ä¸‹ï¼Œé‡åˆ° <code>console.log(1);</code>ï¼Œè¾“å‡º <code>1</code></p>
</li>
<li><p>é‡åˆ° <code>setTimeout()</code>æ˜¯ä¸ªå®ä»»åŠ¡ï¼Œè¿›å…¥ä¸‹ä¸€è½®çš„å®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆğŸš¦ æ³¨æ„ï¼šæ˜¯ä¸‹ä¸€è½®ï¼‰ï¼Œå³<code>å® 2</code>ï¼ˆç¬¬äºŒè½®å®ä»»åŠ¡ï¼‰</p>
</li>
<li><p>é‡åˆ° <code>console.log(2);</code>ï¼Œè¾“å‡º <code>2</code></p>
</li>
<li><p>é‡åˆ° <code>promise.then()</code> è¿™ä¸ªå¾®ä»»åŠ¡ä¸”çŠ¶æ€ä¸º <code>padding</code>ï¼Œä¸æ‰§è¡Œ</p>
</li>
<li><p>é‡åˆ° <code>console.log(4);</code>ï¼Œè¾“å‡º <code>4</code></p>
</li>
<li><p>æœ¬è½®å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼ŒæŸ¥æ‰¾å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ— å¾®ä»»åŠ¡ï¼Œå¼€å§‹ä¸‹ä¸€è½®å®ä»»åŠ¡ï¼ˆè¿™ç§å¾ªç¯æœºåˆ¶ä¾¿æ˜¯ <code>Event Loop</code>ï¼‰</p>
<p><strong>â€”â€”â€”â€”ä¸‹ä¸€è½®â€”â€”â€”â€”</strong></p>
</li>
<li><p>ä¸‹ä¸€è½®å®ä»»åŠ¡ï¼ˆå® 2ï¼‰å¼€å§‹ï¼Œæ‰§è¡Œ <code>setTimeout</code></p>
</li>
<li><p>åœ¨å® 2 é‡åˆ° <code>console.log(timerStart)</code>ï¼Œè¾“å‡º <code>timerStart</code></p>
</li>
<li><p>åœ¨å® 2 é‡åˆ° <code>resolve(&#39;success&#39;)</code>ï¼Œå°† promise çš„çŠ¶æ€æ”¹ä¸º <code>resolved</code> ä¸”ä¿å­˜ç»“æœå¹¶å°†ä¹‹å‰çš„ <code>promise.then()</code> æ¨å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—(å¾…éªŒè¯)</p>
</li>
<li><p>åœ¨å® 2 é‡åˆ° <code>console.log(timerEnd)</code>ï¼Œè¾“å‡º <code>timerEnd</code></p>
</li>
<li><p>åœ¨å® 2 ä¹Ÿå…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼ŒæŸ¥æ‰¾å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå‘ç° <code>promise.then()</code> è¿™ä¸ªå¾®ä»»åŠ¡ï¼Œæ‰§è¡Œå®ƒï¼Œè¾“å‡º <code>success</code><br>è¾“å‡º:</p>
</li>
</ul>
<pre class="line-numbers language-cmd"><code class="language-cmd">1
2
4
'timerStart'
'timerEnd'
'success'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="2-3"><a href="#2-3" class="headerlink" title="2.3"></a>2.3</h4><pre class="line-numbers language-js"><code class="language-js">Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> timer2 <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timer2'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> timer1 <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timer1'</span><span class="token punctuation">)</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¦ç‚¹ï¼š</p>
<ul>
<li>1.å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸Šåˆ›å»ºçš„å®ä»»åŠ¡ä¼šè¢«åæ·»åŠ åˆ°å½“å‰å®ä»»åŠ¡é˜Ÿåˆ—çš„å°¾ç«¯ï¼Œå¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­åˆ›å»ºçš„å¾®ä»»åŠ¡ä¼šè¢«æ·»åŠ åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—çš„å°¾ç«¯ã€‚</li>
<li>2.åªè¦å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­è¿˜æœ‰ä»»åŠ¡ï¼Œå®ä»»åŠ¡é˜Ÿåˆ—å°±åªä¼šç­‰å¾…å¾®ä»»åŠ¡é˜Ÿåˆ—æ‰§è¡Œå®Œæ¯•åå†æ‰§è¡Œã€‚</li>
</ul>
<p>è¿‡ç¨‹åˆ†æï¼š</p>
<ul>
<li><p>ä»ä¸Šè‡³ä¸‹ï¼Œé‡åˆ° <code>Promise.resolve()</code>ï¼Œpromise çŠ¶æ€æ”¹ä¸º <code>resolve</code>, å°† <code>then()</code>åŠ å…¥<code>å¾® 1</code>(æœ¬è½®å¾®ä»»åŠ¡)</p>
</li>
<li><p>é‡åˆ° timer1 çš„<code>setTimeout()</code>æ˜¯ä¸ªå®ä»»åŠ¡ï¼ŒåŠ å…¥ä¸‹ä¸€è½®çš„å®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆğŸš¦ æ³¨æ„ï¼šæ˜¯ä¸‹ä¸€è½®ï¼‰ï¼Œå³<code>å® 2</code>ï¼ˆç¬¬äºŒè½®å®ä»»åŠ¡ï¼‰</p>
</li>
<li><p>é‡åˆ° <code>console.log(start);</code>ï¼Œè¾“å‡º <code>start</code></p>
</li>
<li><p>æœ¬è½®å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼ŒæŸ¥æ‰¾å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ‰§è¡Œ<code>å¾® 1</code> çš„ <code>then()</code></p>
</li>
<li><p>å¾® 1 é‡åˆ° <code>console.log(&#39;promise1&#39;)</code>ï¼Œè¾“å‡º <code>promise1</code></p>
</li>
<li><p>é‡åˆ° timer2 çš„ <code>setTimeout()</code>æ˜¯ä¸ªå®ä»»åŠ¡ï¼ŒåŠ å…¥å®ä»»åŠ¡é˜Ÿåˆ—æœ«å°¾ï¼Œå³<code>å® 3</code>ï¼ˆç¬¬ä¸‰è½®å®ä»»åŠ¡ï¼‰<br><strong>â€”â€”â€”â€”ä¸‹ä¸€è½®â€”â€”â€”â€”</strong></p>
</li>
<li><p>åœ¨å® 2 timer1 çš„ <code>setTimeout</code> æœ€å…ˆåŠ å…¥ç¬¬äºŒè½®å®ä»»åŠ¡ï¼Œæ‰€ä»¥å…ˆæ‰§è¡Œå…¶å†…éƒ¨ä»£ç </p>
</li>
<li><p>åœ¨å® 2 é‡åˆ° console.log(â€˜timer1â€™)ï¼Œ è¾“å‡º <code>timer1</code></p>
</li>
<li><p>åœ¨å® 2 é‡åˆ° <code>Promise.resolve().then(()</code>ï¼Œä¸€æ°”å‘µæˆï¼Œæ”¹å˜ promise çŠ¶æ€ä¸º <code>resolve</code>ï¼Œå¹¶ä¸”å°† <code>then()</code> åŠ å…¥<code>å¾®ä»»åŠ¡</code></p>
</li>
<li><p>timer1 çš„<code>å®2</code> æ‰§è¡Œå®Œæ¯•ï¼Œæ¥ç€å¼€å§‹å»æ‰§è¡Œæ‰€æœ‰<code>å¾®ä»»åŠ¡</code>ï¼Œæ‰§è¡Œ <code>then()</code>ï¼Œè¾“å‡º <code>promise2</code></p>
<p><strong>â€”â€”â€”â€”ä¸‹ä¸€è½®â€”â€”â€”â€”</strong></p>
</li>
<li><p>åœ¨å® 3 å‰©ä¸‹ timer2 çš„ <code>setTimeout</code> ï¼Œè¾“å‡º <code>timer2</code></p>
</li>
</ul>
<p>æ€»ç»“ï¼š</p>
<ol>
<li>å¦‚æœåœ¨æ‰§è¡Œ <code>å®ä»»åŠ¡ï¼ˆå®2ï¼‰</code> çš„è¿‡ç¨‹ä¸­ï¼Œåˆäº§ç”Ÿäº† <code>å®ä»»åŠ¡ï¼ˆå®3ï¼‰</code>ï¼Œé‚£ä¹ˆä¼šåŠ å…¥åˆ°é˜Ÿåˆ—çš„æœ«å°¾ï¼Œä¼šåœ¨æ‰§è¡Œå®Œ<code>å®2</code>åˆ°<code>å¾®ä»»åŠ¡</code> å†åˆ° <code>ï¼ˆå®3ï¼‰</code></li>
<li>å¦‚æœåœ¨æ‰§è¡Œ <code>å¾®ä»»åŠ¡</code> çš„è¿‡ç¨‹ä¸­ï¼Œåˆäº§ç”Ÿäº† <code>å¾®ä»»åŠ¡</code>ï¼Œé‚£ä¹ˆä¼šåŠ å…¥åˆ°é˜Ÿåˆ—çš„æœ«å°¾ï¼Œä¹Ÿä¼šåœ¨è¿™ä¸ªå‘¨æœŸè¢«è°ƒç”¨æ‰§è¡Œï¼›</li>
</ol>
<pre class="line-numbers language-cmd"><code class="language-cmd">'start'
'promise1'
'timer1'
'promise2'
'timer2'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="2-4"><a href="#2-4" class="headerlink" title="2.4"></a>2.4</h4><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">const</span> promise1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> promise2 <span class="token operator">=</span> promise1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'error!!!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">,</span> promise1<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">,</span> promise2<span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">,</span> promise1<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">,</span> promise2<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ€»ç»“ï¼š</p>
<ol>
<li><code>Promise.then()</code>æŠ›å‡ºäº†ä¸€ä¸ªé”™è¯¯ï¼Œä¸”å°† promise2 çš„çŠ¶æ€è®¾ç½®ä¸ºäº† <code>rejected</code><br>å¦‚æœæ˜¯ <code>return</code> åˆ™çŠ¶æ€ä¸º <code>resolve</code></li>
</ol>
<pre class="line-numbers language-js"><code class="language-js"><span class="token string">'promise1'</span> Promise<span class="token punctuation">{</span><span class="token operator">&lt;</span>pending<span class="token operator">></span><span class="token punctuation">}</span>
<span class="token string">'promise2'</span> Promise<span class="token punctuation">{</span><span class="token operator">&lt;</span>pending<span class="token operator">></span><span class="token punctuation">}</span>
Uncaught <span class="token punctuation">(</span><span class="token keyword">in</span> promise<span class="token punctuation">)</span> Error<span class="token punctuation">:</span> error<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span> at test<span class="token punctuation">.</span>html<span class="token punctuation">:</span><span class="token number">102</span>
<span class="token string">'promise1'</span> Promise<span class="token punctuation">{</span><span class="token operator">&lt;</span>resolved<span class="token operator">></span><span class="token punctuation">:</span> <span class="token string">"success"</span><span class="token punctuation">}</span>
<span class="token string">'promise2'</span> Promise<span class="token punctuation">{</span><span class="token operator">&lt;</span>rejected<span class="token operator">></span><span class="token punctuation">:</span> Error<span class="token punctuation">:</span> error<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="2-5"><a href="#2-5" class="headerlink" title="2.5"></a>2.5</h4><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">const</span> promise1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timer1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1é‡Œçš„å†…å®¹'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> promise2 <span class="token operator">=</span> promise1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'error!!!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">,</span> promise1<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">,</span> promise2<span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timer2'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">,</span> promise1<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">,</span> promise2<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿‡ç¨‹åˆ†æï¼š</p>
<ul>
<li>é‡è§ <code>promise1</code>ï¼Œ å°† <code>setTimeout</code> åŠ å…¥ <code>å®1</code></li>
<li>é‡è§ <code>console.log(&#39;promise1é‡Œçš„å†…å®¹&#39;)</code> è¾“å‡º <code>promise1é‡Œçš„å†…å®¹</code></li>
<li>é‡è§ <code>promise2</code>ï¼Œ ä¸æ‰§è¡Œ</li>
<li>ç”±äº promise1ã€promise1 éƒ½æœªæ”¹å˜çŠ¶æ€ï¼Œæ‰€ä»¥è¾“å‡º<br><code>&#39;promise1&#39; Promise{&lt;pending&gt;} å’Œ &#39;promise2&#39; Promise{&lt;pending&gt;}</code></li>
<li>é‡è§ <code>setTimeout</code> åŠ å…¥ <code>å®2</code></li>
</ul>
<p><strong>â€”â€”â€”â€”ä¸‹ä¸€è½®â€”â€”â€”â€”</strong></p>
<ul>
<li>æ‰§è¡Œ <code>å®1</code>ï¼Œ <code>promise1</code> çŠ¶æ€æ”¹ä¸º <code>resolve</code>, è¾“å‡º <code>timer1</code></li>
<li><code>å®1</code> æ‰§è¡Œå®Œï¼Œæ£€æŸ¥ <code>å¾®ä»»åŠ¡</code> å‘ç° <code>promise2</code> å¯ä»¥æ‰§è¡Œ, æŠ›å‡ºä¸€ä¸ªé”™è¯¯</li>
<li>ç„¶åæ‰§è¡Œåˆ° <code>å®2</code>ï¼Œè¾“å‡º <code>timer2</code></li>
<li><code>promise1</code> å·²ç» <code>resolve</code> ï¼Œ<code>promise2</code>ï¼Œç”±äºæŠ›å‡ºé”™è¯¯ï¼Œæ‰€ä»¥ <code>rejected</code></li>
</ul>
<pre class="line-numbers language-js"><code class="language-js"><span class="token string">'promise1é‡Œçš„å†…å®¹'</span>
<span class="token string">'promise1'</span> Promise<span class="token punctuation">{</span><span class="token operator">&lt;</span>pending<span class="token operator">></span><span class="token punctuation">}</span>
<span class="token string">'promise2'</span> Promise<span class="token punctuation">{</span><span class="token operator">&lt;</span>pending<span class="token operator">></span><span class="token punctuation">}</span>
<span class="token string">'timer1'</span>
Uncaught <span class="token punctuation">(</span><span class="token keyword">in</span> promise<span class="token punctuation">)</span> Error<span class="token punctuation">:</span> error<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span> at test<span class="token punctuation">.</span>html<span class="token punctuation">:</span><span class="token number">102</span>
<span class="token string">'timer2'</span>
<span class="token string">'promise1'</span> Promise<span class="token punctuation">{</span><span class="token operator">&lt;</span>resolved<span class="token operator">></span><span class="token punctuation">:</span> <span class="token string">"success"</span><span class="token punctuation">}</span>
<span class="token string">'promise2'</span> Promise<span class="token punctuation">{</span><span class="token operator">&lt;</span>rejected<span class="token operator">></span><span class="token punctuation">:</span> Error<span class="token punctuation">:</span> error<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Promise-ä¸­çš„-thenã€catchã€finally"><a href="#Promise-ä¸­çš„-thenã€catchã€finally" class="headerlink" title="Promise ä¸­çš„ thenã€catchã€finally"></a>Promise ä¸­çš„ thenã€catchã€finally</h3><h4 id="3-1"><a href="#3-1" class="headerlink" title="3.1"></a>3.1</h4><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success1'</span><span class="token punctuation">)</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
promise
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'then: '</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'catch: '</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç»“æœ:</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token string">'then: success1'</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Promise çš„çŠ¶æ€ä¸€ç»æ”¹å˜å°±ä¸èƒ½å†æ”¹å˜</p>
<h4 id="3-2"><a href="#3-2" class="headerlink" title="3.2"></a>3.2</h4><pre class="line-numbers language-js"><code class="language-js">Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">2</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">3</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'error!!!'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>catch() ä¸ç®¡è¢«è¿æ¥åˆ°å“ªé‡Œï¼Œéƒ½èƒ½æ•è·ä¸Šå±‚æœªæ•æ‰è¿‡çš„é”™è¯¯</li>
<li>return 3 ä¼šè¢«åŒ…è£…æˆ <code>resolve(3)</code></li>
<li>return new Error(â€˜error!!!â€™) ä¼šè¢«åŒ…è£…æˆ <code>resolve(new Error(&#39;error!!!&#39;))</code></li>
</ul>
<p>ç»“æœ</p>
<pre class="line-numbers language-bash"><code class="language-bash">1
3
<span class="token string">'Error: error!!!'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>å¦‚æœä¸å¸Œæœ›ç»§ç»­å‘ä¸‹ï¼Œå¯ä»¥</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token keyword">return</span> Promise.reject<span class="token punctuation">(</span>new Error<span class="token punctuation">(</span><span class="token string">'error!!!'</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
// or
throw new Error<span class="token punctuation">(</span><span class="token string">'error!!!'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="3-3"><a href="#3-3" class="headerlink" title="3.3"></a>3.3</h4><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">const</span> promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> promise
<span class="token punctuation">}</span><span class="token punctuation">)</span>
promise<span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>err<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>.then</code> æˆ– <code>.catch()</code> ä¸èƒ½è¿”å› promise æœ¬èº«ï¼Œä¸ç„¶ä¼šé€ æˆæ­»å¾ªç¯ã€‚</p>
<p>ç»“æœï¼š</p>
<pre class="line-numbers language-js"><code class="language-js">Promise <span class="token punctuation">{</span><span class="token operator">&lt;</span>rejected<span class="token operator">></span><span class="token punctuation">:</span> TypeError<span class="token punctuation">:</span> Chaining cycle detected <span class="token keyword">for</span> promise #<span class="token operator">&lt;</span>Promise<span class="token operator">></span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="3-4"><a href="#3-4" class="headerlink" title="3.4"></a>3.4</h4><pre class="line-numbers language-js"><code class="language-js">Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ä¸­é—´çš„ä¸¤ä¸ª <code>then</code> ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™ <code>1</code> ä¼šå¾€ä¸‹èµ°</p>
<p>ç»“æœï¼š</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="3-5"><a href="#3-5" class="headerlink" title="3.5"></a>3.5</h4><pre class="line-numbers language-js"><code class="language-js">Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'err!!!'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'catch'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç»“æœï¼š</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token string">'error'</span> <span class="token string">'error!!!'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å¦‚æœ <code>then</code> æ— ç¬¬äºŒä¸ªå‚æ•°ï¼Œé‚£ä¹ˆé”™è¯¯å°†è¿›å…¥ <code>catch()</code><br>å¦‚æœé”™è¯¯ç”± <code>then</code>å†…éƒ¨äº§ç”Ÿï¼Œé‚£ä¹ˆé”™è¯¯å°†å‘ä¸‹èµ°è¿›å…¥ <code>catch()</code></p>
<h4 id="3-6"><a href="#3-6" class="headerlink" title="3.6"></a>3.6</h4><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">promise1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> p
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">promise2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">promise1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'finally ä¼šä¼ ä¸‹å»'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finally1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">promise2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finally2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>é“¾å¼è°ƒç”¨éƒ½éœ€è¦ç­‰ä¸Šä¸€ä¸ªå®Œæˆæ‰å¯ä»¥æ‰§è¡Œï¼Œæ‰€ä»¥ <code>promise1</code> çš„ <code>then</code> ä¸ä¼šé©¬ä¸Šåˆ° <code>finally</code></li>
<li><code>finally</code> ä¼šè¿”å›ä¸Šä¸€ä¸ª Promise å¯¹è±¡å€¼</li>
<li><code>finally</code> å›è°ƒå‡½æ•°ä¸æ¥å—ä»»ä½•çš„å‚æ•°</li>
<li>åˆ«å¿˜è®°äº† <code>thenã€catch å’Œ finally</code> æ˜¯å¾®ä»»åŠ¡</li>
</ul>
<p>ç»“æœï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash">promise1
1
error
finally1
finally2
<span class="token string">'finally ä¼šä¼ ä¸‹å»'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Promise-ä¸­çš„-all-å’Œ-race"><a href="#Promise-ä¸­çš„-all-å’Œ-race" class="headerlink" title="Promise ä¸­çš„ all() å’Œ race()"></a>Promise ä¸­çš„ all() å’Œ race()</h3><p>æˆ‘ä»¬å…ˆçœ‹çœ‹ <a href="https://juejin.im/post/5e58c618e51d4526ed66b5cf" target="_blank" rel="noopener">å‘†å“¥</a> çš„æ€»ç»“</p>
<blockquote>
<p>é€šä¿—æ¥è¯´ï¼Œ<code>.all()</code>çš„ä½œç”¨æ˜¯æ¥æ”¶ä¸€ç»„å¼‚æ­¥ä»»åŠ¡ï¼Œç„¶åå¹¶è¡Œæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œåæ‰æ‰§è¡Œå›è°ƒã€‚<br><code>.race()</code>çš„ä½œç”¨ä¹Ÿæ˜¯æ¥æ”¶ä¸€ç»„å¼‚æ­¥ä»»åŠ¡ï¼Œç„¶åå¹¶è¡Œæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œåªä¿ç•™å–ç¬¬ä¸€ä¸ªæ‰§è¡Œå®Œæˆçš„å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå…¶ä»–çš„æ–¹æ³•ä»åœ¨æ‰§è¡Œï¼Œä¸è¿‡æ‰§è¡Œç»“æœä¼šè¢«æŠ›å¼ƒã€‚</p>
</blockquote>
<p>å¾ˆæ˜æ˜¾ <code>all()</code> æ˜¯å…¨éƒ½ä¸”ç»Ÿä¸€å¾—å‡ºç»“æœ, <code>race()</code> æ˜¯ç«é€Ÿ</p>
<p>é¦–å…ˆæ¥çœ‹ <code>all()</code></p>
<h4 id="4-1"><a href="#4-1" class="headerlink" title="4.1"></a>4.1</h4><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">runAsync</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">r</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> p
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">runReject</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> rej<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">rej</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span> <span class="token operator">*</span> x<span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">return</span> p
<span class="token punctuation">}</span>

Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>

Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">runReject</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">runReject</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æŒ‰é“ç†ï¼Œç¬¬ä¸€ä¸ª <code>Promise.all()</code> ä¼šè¾“å‡ºä¸€ä¸ªæ•°ç»„ <code>[...]</code>ï¼Œé‡Œé¢åŒ…å«äº†æ‰€æœ‰çš„ç»“æœ</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token punctuation">;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æ¥ç€ç¬¬äºŒä¸ª<code>Promise.all()</code><br>ä¼šåˆ†åˆ«æ‰§è¡Œå„è‡ªçš„ä»£ç ï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä¼šèµ°åˆ° <code>then()</code> è¾“å‡ºä¸€ä¸ªæ•°ç»„ï¼Œä½†æ˜¯å…¶ä¸­ä¸€ä¸ª <code>å¼‚å¸¸</code> åˆ™è¢«æ•è·ï¼Œä¸è¿›å…¥ <code>then(res,err)</code> çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚<br>è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ— è®ºä¸€åŒæ‰§è¡Œçš„å¼‚æ­¥æ˜¯å¦ä¼šæŠ¥é”™ï¼Œ<code>æ‰§è¡Œè¿‡ç¨‹å®ƒä»¬ä¹‹é—´äº’ä¸å½±å“</code>ã€‚</p>
<p>ç›¸ä¿¡ä½ èƒ½å¤Ÿå¾ˆæ¸…æ¥šçŸ¥é“ç»“æœ</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token number">1</span>
<span class="token number">3</span>
<span class="token number">2</span>
<span class="token number">1</span> Error<span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token number">4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸‹é¢çœ‹ä¸€ä¸‹ <code>race()</code></p>
<h4 id="4-2"><a href="#4-2" class="headerlink" title="4.2"></a>4.2</h4><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">runAsync</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">r</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> p
<span class="token punctuation">}</span>
Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'result: '</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>race</code> æœ‰æ¯”èµ›ï¼Œèµ›è·‘çš„æ„æ€ï¼Œæ‰€ä»¥æœ€åçš„ç»“æœä¼šåœ¨å¤šä¸ª <code>&quot;é€‰æ‰‹&quot;</code> ä¸­äº§ç”Ÿ<br>æ— è®ºæ‰§è¡Œå®Œè¿˜æ˜¯æŠ›å‡ºé”™è¯¯ï¼Œéƒ½ä¼šå„è‡ªæ‰§è¡Œå®Œï¼Œä½†æ˜¯ <code>ç»“æœæœ‰ä¸”åªæœ‰ä¸€ä¸ª</code>ã€‚</p>
<p>ç»“æœï¼š</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token number">1</span>
result<span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token number">2</span>
<span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ€»ç»“ <code>Promise.all() å’Œ Promise.race()</code></p>
<ul>
<li><code>all()</code> åŒæ—¶è¾“å‡ºä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«æ‰€æœ‰çš„ç»“æœ</li>
<li><code>race()</code> è¾“å‡ºæœ€å¿«çš„ä¸€ä¸ªç»“æœï¼Œå…¶ä½™çš„ç»“æœä¼šè¢«æŠ›å¼ƒï¼›åŒæ­¥ &gt; å¼‚æ­¥ï¼Œå¹¶ä¸”è¶Šé å‰è¶Šä¼˜å…ˆ</li>
</ul>
<p>é‡åˆ°é”™è¯¯éƒ½ä¼šè¢«æ•è·ï¼Œä¹Ÿæ‰§è¡Œå®Œæ‰€æ¥æ”¶çš„ä»»åŠ¡ï¼›<br>è¾“å‡ºç»“æœçš„é¡ºåºå’Œæ¥å—é¡ºåºä¸€è‡´ï¼›</p>
<h3 id="async-await"><a href="#async-await" class="headerlink" title="async/await"></a>async/await</h3><h4 id="5-1"><a href="#5-1" class="headerlink" title="5.1"></a>5.1</h4><p>å‚è€ƒ <a href="http://www.ruanyifeng.com/blog/2015/05/async.html" target="_blank" rel="noopener">é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—</a></p>
<blockquote>
<p>async å‡½æ•°å°±æ˜¯ Generator å‡½æ•°çš„è¯­æ³•ç³–ã€‚<br>async å‡½æ•°å°±æ˜¯å°† Generator å‡½æ•°çš„æ˜Ÿå·ï¼ˆ*ï¼‰æ›¿æ¢æˆ asyncï¼Œå°† yield æ›¿æ¢æˆ awaitï¼Œä»…æ­¤è€Œå·²</p>
</blockquote>
<p><code>async/await</code> æ¯” <code>promise</code> å¯è¯»æ€§æ›´å¥½ï¼Œä¹Ÿæ˜¯ä¸€ç§å¼‚æ­¥è§£å†³æ–¹æ¡ˆ<br>å¦‚ä¸‹ï¼Œå¼‚æ­¥ä»£ç å°±åƒåŒæ­¥ä¸€æ ·çš„å†™æ³•ï¼Œå¹¶ä¸”æ˜¯å¯ä¿¡çš„ï¼Œä¸å¿…ä»å¤´å†ç›˜ä¸€æ¬¡æ€è·¯</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getStockPriceByName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> n1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n1<span class="token punctuation">)</span>
  <span class="token keyword">var</span> n2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n2<span class="token punctuation">)</span>
  <span class="token keyword">var</span> n3 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n3<span class="token punctuation">)</span>
  <span class="token keyword">return</span> n1
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getValue</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">resolve</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">,</span> timer<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">getStockPriceByName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'result:'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç»“æœ</p>
<pre class="line-numbers language-bash"><code class="language-bash">400
200
0
result: 400<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>è®©æˆ‘ä»¬çœ‹çœ‹ <code>promsie</code> å†™æ³•</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getStockPriceByName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> p
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getValue</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">resolve</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">,</span> timer<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">getStockPriceByName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'result:'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å®ƒä»¬çš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œå½“ç„¶å¦‚æœåªæ˜¯è¿™æ ·çœ‹æ˜¯çœ‹ä¸æ¸…æ¥š <code>await</code> æ˜¯å¦‚ä½•ç­‰å¾…çš„,å†çœ‹ä¸‹é¢ä¸€ä¸ªä¾‹å­</p>
<h4 id="5-2"><a href="#5-2" class="headerlink" title="5.2"></a>5.2</h4><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿‡ç¨‹åˆ†æï¼š</p>
<ul>
<li>å¼€å¤´ä¸ºå‡½æ•°å£°æ˜ï¼Œä¸æ‰§è¡Œï¼Œå†å¾€ä¸‹çœ‹å‘ç°å‡½æ•° <code>async1()</code> è¢«è°ƒç”¨</li>
<li>æ‰§è¡Œ <code>async1()</code> è¾“å‡º <code>async1 start</code></li>
<li>é‡åˆ° <code>await</code> å…ˆæ‰§è¡Œé‡Œé¢çš„åŒæ­¥æ–¹æ³•ï¼Œè¾“å‡º <code>async2</code></li>
<li><strong>æ­¤å¤„æ˜¯é‡ç‚¹</strong>ï¼Œ<code>await</code> å°†çº¿ç¨‹äº¤å‡ºå»ï¼Œä¹Ÿå°±æ˜¯æŠŠ <code>async</code> å‡½æ•°å‰©ä¸‹çš„ä»£ç åŒ…è£…æˆ <code>promise</code> çš„ <code>resolve</code> å¹¶ä¸” <code>return</code> å‡ºå»</li>
<li>await åé¢çš„ä»£ç ï¼Œ å³<code>console.log(&#39;async1 end&#39;)</code> è¢«æ”¾å…¥ <code>å¾®ä»»åŠ¡</code> ä¸­ï¼Œç„¶åè·³å‡º async1()</li>
<li>é‡åˆ° <code>console.log(&#39;start&#39;)</code>ï¼Œè¾“å‡º <code>start</code>ï¼Œæœ¬è½® <code>å®ä»»åŠ¡</code> æ‰§è¡Œå®Œï¼Œæ£€æŸ¥ <code>å¾®ä»»åŠ¡</code></li>
<li>å‘ç° <code>await</code> äº§ç”Ÿçš„ å¾®ä»»åŠ¡ï¼Œè¾“å‡º <code>async1 end</code></li>
</ul>
<p>ç»“æœï¼š</p>
<pre class="line-numbers language-bash"><code class="language-bash">async1 start
async2
start
async1 end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¾‹å­ 5.2 å¯ä»¥å†™æˆ <code>promise</code></p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span>
  <span class="token keyword">new</span> <span class="token class-name">promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// æ­¤å¤„ä¸º await åç»­çš„ä»£ç </span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>then()</code> æ˜¯ä¸æ˜¯å¥½ç†è§£ä¸€äº›ï¼Œå½“ç„¶ç†è§£äº†ï¼Œæœ€åè¿˜æ˜¯ <code>await</code> åœ¨ä½¿ç”¨ä¸Šæ¯”è¾ƒé¦™</p>
<p>è¿™é‡Œå°±ä¸å†å±•å¼€æ›´å¤š <code>åœ°ç‹±å¼é¢˜ç›®</code> äº†ï¼Œå¦‚æœæœ‰éœ€è¦ï¼Œå¯ä»¥å‰å¾€ <a href="https://juejin.im/post/5e58c618e51d4526ed66b5cf#heading-33" target="_blank" rel="noopener">å‘†å‘†çš„æ˜é‡‘</a></p>
<p>ä½†æ˜¯å¥½ç”¨å½’å¥½ç”¨ï¼Œè¿˜æ˜¯æœ‰äº›é—®é¢˜éœ€è¦æ³¨æ„</p>
<p><code>promise</code> ä¸ <code>async/await</code> ä¸€æ ·ï¼Œå¦‚æœåœ¨<code>å†…éƒ¨å‘ç”Ÿé”™è¯¯</code>æˆ–è€…è¢« <code>reject()</code> é‚£ä¹ˆæ˜¯ä¸ä¼šå¾€ä¸‹èµ°çš„</p>
<p>æ‹¿ 5.1 ä¸¾ä¸ªä¾‹å­</p>
<pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getStockPriceByName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> n1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n1<span class="token punctuation">)</span>
  <span class="token keyword">var</span> n2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n2<span class="token punctuation">)</span>
  <span class="token keyword">var</span> n3 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n3<span class="token punctuation">)</span>
  <span class="token keyword">return</span> n1
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getValue</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">200</span> <span class="token operator">===</span> timer<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'error200'</span><span class="token punctuation">)</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">resolve</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">,</span> timer<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">getStockPriceByName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'result:'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç»“æœ</p>
<pre class="line-numbers language-bash"><code class="language-bash">400
Uncaught <span class="token punctuation">(</span>in promise<span class="token punctuation">)</span> error200<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>promise</code> æœ‰<code>catch/finally</code> å¥½æ­æ¡£ï¼Œ<br>é‚£ä¹ˆ <code>await</code> ä¹Ÿæœ‰ <code>try/catch/finally</code></p>
<p>æ—¶åˆ»è°¨è®°å¤„ç†å¼‚å¸¸ï¼Œä¸ç„¶æ˜¯å¾ˆå±é™©çš„ï¼Œ<del>æˆ‘å°±è€æ˜¯å¿˜è®°!</del></p>
<hr>
<p>å¥½äº†ï¼Œæœ‰å…³å¼‚æ­¥çš„åŸºç¡€çŸ¥è¯†å…ˆè®°å½•åˆ°è¿™ï¼Œåç»­æ ¹æ®å†æ·±å…¥äº†è§£æ›´å¤šå¼‚æ­¥çš„å†…å®¹<br>å¦‚</p>
<ul>
<li>æ ¹æ® promiseA+å®ç°ä¸€ä¸ªè‡ªå·±çš„ promise</li>
<li>ä½¿ç”¨å¼‚æ­¥æ¥è§£å†³å®é™…åŠŸèƒ½ï¼ˆçº¢ç»¿ç¯ã€åŠ è½½å›¾ç‰‡ç­‰ï¼‰</li>
</ul>
</p></div><div class="pagination"><p class="clearfix"><span class="pre pagbuttons"><a role="navigation" href="/JS%E7%BB%A7%E6%89%BF.html" title="ç¬”è®°-JSç»§æ‰¿"><i class="fa fa-angle-double-left"></i>&nbsp;ä¸Šä¸€ç¯‡: ç¬”è®°-JSç»§æ‰¿</a></span><span>&nbsp;</span><span class="next pagbuttons"><a role="navigation" href="/chrome-devtools.html" title="Chrome Devtoolsçš„è°ƒè¯•æŠ€å·§">ä¸‹ä¸€ç¯‡: Chrome Devtoolsçš„è°ƒè¯•æŠ€å·§&nbsp;<i class="fa fa-angle-double-right"></i></a></span></p></div><a id="comments"></a><div id="valine-container"></div><script>(function(){
    if(typeof Valine !== 'undefined'){
        new Valine({
            el:'#valine-container',
            appId: 'C5UQwaddmDNfGT2GyHq1RKN4-gzGzoHsz',
            appKey: 'nwu3U2sv3JcUcitnVTaO22GS',
            path: window.location.pathname,
            avatar:'robohash',
            serverURLs: 'https://leancloud.pengliang.online'
        })
    }
}())
</script></div></div></div><div class="visible-xs site-bottom-footer"><footer><p>&copy;&nbsp;2020&nbsp;<a target="_blank" href="https://github.com/PL-FE" rel="noopener noreferrer">pengliang</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div></div><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/google-analytics.js"></script><script src="/js/typography.min.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"live2d_models/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/live2d_models/xxban.model.json"},"display":{"position":"right","width":325,"height":300,"hOffset":0,"vOffset":0},"log":false});</script></body></html>